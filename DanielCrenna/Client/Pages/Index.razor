@page "/"
@using DanielCrenna.Shared
@using Markdig

@inject HttpClient Http
@inject IJSRuntime Javascript

@foreach (var post in _posts ?? Enumerable.Empty<BlogPost>())
{
    <h1>@post.Title</h1>
    @(new MarkupString(Markdown.ToHtml(post.Body, _pipeline)))
    <br />
}

@code
{
    private IEnumerable<BlogPost> _posts;

    private MarkdownPipeline _pipeline;

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();

        _pipeline = new MarkdownPipelineBuilder()
            .UseAdvancedExtensions()
            .Build();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await Javascript.InvokeVoidAsync("onAfterRender");
    }

    protected override async Task OnInitializedAsync()
    {
        _posts = await Http.GetFromJsonAsync<IEnumerable<BlogPost>>("posts");
    }
}